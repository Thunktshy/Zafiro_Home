<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Zafiro Home — Panel Admin · Reportes</title>

  <!-- Estilos opcionales -->
  <link rel="stylesheet" href="/admin-resources/css/styles/index.css" />
  <link rel="stylesheet" href="/admin-resources/css/forms/forms.css" />

  <!-- Bootstrap + DataTables -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/dataTables.bootstrap5.min.css" />
</head>
<body class="admin-body">
  <!-- Header con regreso al panel -->
  <header class="py-3 mb-4 border-bottom bg-light">
    <div class="container-xl d-flex align-items-center justify-content-between">
      <h1 class="h3 m-0">Zafiro Home — Panel Admin</h1>
      <nav>
        <a class="btn btn-outline-secondary btn-sm" href="/admin-resources/pages/admin.html">
          ← Regresar al panel principal
        </a>
      </nav>
    </div>
  </header>

  <main class="container-xl my-4">
    <div class="d-flex align-items-center justify-content-between mb-3">
      <h2 class="h4 m-0">Administración · Reportes</h2>
    </div>

    <!-- Alertas -->
    <div id="alertBox" class="alert d-none" role="alert"></div>

    <!-- Fechas / acciones -->
    <section class="card mb-4 shadow-sm">
      <div class="card-body">
        <div class="row g-3 align-items-end">
          <div class="col-12 col-md-3">
            <label for="desde" class="form-label">Desde</label>
            <input id="desde" type="date" class="form-control" />
          </div>
          <div class="col-12 col-md-3">
            <label for="hasta" class="form-label">Hasta</label>
            <input id="hasta" type="date" class="form-control" />
          </div>
          <div class="col-12 col-md-6 d-flex gap-2 justify-content-md-end">
            <button id="btnAplicarFechas" class="btn btn-primary">
              <i class="fa-solid fa-filter me-1"></i>Aplicar a todos
            </button>
            <button id="btnLimpiarFechas" class="btn btn-outline-secondary">Limpiar</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Tabs -->
    <ul class="nav nav-tabs" id="tabsReportes" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="tab-pivot" data-bs-toggle="tab" data-bs-target="#pane-pivot" type="button" role="tab">Ventas mensual (pivot)</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="tab-top" data-bs-toggle="tab" data-bs-target="#pane-top" type="button" role="tab">Top ventas</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="tab-clientes" data-bs-toggle="tab" data-bs-target="#pane-clientes" type="button" role="tab">Clientes · Frecuencia</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="tab-historial" data-bs-toggle="tab" data-bs-target="#pane-historial" type="button" role="tab">Historial por cliente</button>
      </li>
    </ul>

    <div class="tab-content pt-3">
      <!-- Pivot -->
      <div class="tab-pane fade show active" id="pane-pivot" role="tabpanel" aria-labelledby="tab-pivot">
        <div class="row g-3">
          <div class="col-12 col-lg-6">
            <div class="card shadow-sm">
              <div class="card-body">
                <h5 class="card-title mb-3">Tabla</h5>
                <div class="table-responsive">
                  <table id="tablaPivot" class="table table-striped table-hover align-middle" style="width:100%">
                    <thead>
                      <tr>
                        <th>Año-Mes</th>
                        <th>Ventas</th>
                        <th>Importe</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 col-lg-6">
            <div class="card shadow-sm">
              <div class="card-body">
                <h5 class="card-title mb-3">Tendencia</h5>
                <canvas id="chartPivot" height="200"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Top ventas -->
      <div class="tab-pane fade" id="pane-top" role="tabpanel" aria-labelledby="tab-top">
        <div class="row g-3">
          <div class="col-12 col-lg-6">
            <div class="card shadow-sm">
              <div class="card-body">
                <div class="d-flex align-items-center justify-content-between">
                  <h5 class="card-title mb-0">Top ventas</h5>
                  <div class="d-flex align-items-center gap-2">
                    <label for="limitTop" class="form-label m-0">Límite</label>
                    <input id="limitTop" type="number" min="3" max="50" value="10" class="form-control form-control-sm" style="width:90px" />
                    <button id="btnRefrescarTop" class="btn btn-outline-primary btn-sm">Refrescar</button>
                  </div>
                </div>
                <div class="table-responsive mt-3">
                  <table id="tablaTop" class="table table-striped table-hover align-middle" style="width:100%">
                    <thead>
                      <tr>
                        <th>#</th>
                        <th>Producto</th>
                        <th>Unidades</th>
                        <th>Importe</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 col-lg-6">
            <div class="card shadow-sm">
              <div class="card-body">
                <h5 class="card-title mb-3">Ranking</h5>
                <canvas id="chartTop" height="200"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Clientes frecuencia -->
      <div class="tab-pane fade" id="pane-clientes" role="tabpanel" aria-labelledby="tab-clientes">
        <div class="row g-3">
          <div class="col-12 col-lg-6">
            <div class="card shadow-sm">
              <div class="card-body">
                <h5 class="card-title mb-3">Tabla</h5>
                <div class="table-responsive">
                  <table id="tablaClientes" class="table table-striped table-hover align-middle" style="width:100%">
                    <thead>
                      <tr>
                        <th>Cliente</th>
                        <th>Cuenta/Email</th>
                        <th>Pedidos</th>
                        <th>Importe</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 col-lg-6">
            <div class="card shadow-sm">
              <div class="card-body">
                <h5 class="card-title mb-3">Top por pedidos</h5>
                <canvas id="chartClientes" height="200"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Historial cliente -->
      <div class="tab-pane fade" id="pane-historial" role="tabpanel" aria-labelledby="tab-historial">
        <div class="card shadow-sm">
          <div class="card-body">
            <div class="row g-3 align-items-end">
              <div class="col-12 col-md-3">
                <label for="histCliente" class="form-label">Cliente</label>
                <input id="histCliente" class="form-control" type="text" placeholder="cl-123 o 123" />
                <div class="form-text">Se normaliza a <code>cl-</code>.</div>
              </div>
              <div class="col-12 col-md-3">
                <label for="histDesde" class="form-label">Desde</label>
                <input id="histDesde" type="date" class="form-control" />
              </div>
              <div class="col-12 col-md-3">
                <label for="histHasta" class="form-label">Hasta</label>
                <input id="histHasta" type="date" class="form-control" />
              </div>
              <div class="col-12 col-md-3 d-grid">
                <button id="btnBuscarHist" class="btn btn-primary">Buscar</button>
              </div>
            </div>
            <div class="table-responsive mt-3">
              <table id="tablaHistorial" class="table table-striped table-hover align-middle" style="width:100%">
                <thead>
                  <tr>
                    <th>Pedido</th>
                    <th>Fecha</th>
                    <th>Estado</th>
                    <th>Importe</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

    </div>
  </main>

  <footer class="container-xl mt-5 py-4 border-top text-center text-muted">
    <small>© 2025 Zafiro Home</small>
  </footer>

  <!-- Librerías -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.8/js/dataTables.bootstrap5.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <!-- API + UI -->
  <script type="module" src="/admin-resources/scripts/apis/reportesManager.js"></script>
  <script type="module" src="/admin-resources/scripts/forms/reportes.js"></script>
</body>
</html>
