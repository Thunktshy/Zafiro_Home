<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Administración — Control de Pedidos</title>

  <!-- Estilos generales y de formularios -->
  <link rel="stylesheet" href="/admin-resources/css/styles/index.css" />
  <link rel="stylesheet" href="/admin-resources/css/forms/forms.css" />

  <!-- Bootstrap + DataTables + Bootstrap Icons (mismas dependencias del panel Pedidos) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/dataTables.bootstrap5.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
</head>
<body class="admin-body">
  <header class="admin-header">
    <div class="container-xl d-flex align-items-center justify-content-between py-3">
      <h1 class="h3 m-0">Administración · Control de Pedidos</h1>
      <nav>
        <a class="btn btn-outline-secondary" href="/admin-resources/pages/paneles-administracion/index.html">Volver al panel</a>
      </nav>
    </div>
  </header>

  <main class="container-xl my-4">
    <!-- Alertas (feedback) -->
    <div id="alertBox" class="alert d-none" role="alert"></div>

    <!-- Selector de pedido + acciones globales -->
    <section class="card mb-4 shadow-sm">
      <div class="card-body">
        <div class="row g-3 align-items-end">
          <div class="col-12 col-md-4">
            <label for="pedido_id" class="form-label">ID de pedido</label>
            <div class="input-group">
              <input id="pedido_id" type="text" class="form-control" placeholder="ped-1 o 1" maxlength="20" />
              <button id="btnCargar" class="btn btn-primary"><i class="bi bi-search"></i> Cargar</button>
            </div>
            <div class="form-text">Puedes pegar la URL con <code>?pid=ped-#</code> para auto-cargar.</div>
          </div>

          <div class="col-12 col-md-8 d-flex flex-wrap gap-2 justify-content-md-end">
            <button id="btnVerificar" class="btn btn-outline-info" disabled>
              <i class="bi bi-clipboard-check"></i> Verificar stock
            </button>
            <div class="btn-group" role="group">
              <button id="btnSetPorConfirmar" class="btn btn-outline-secondary" disabled>
                <i class="bi bi-arrow-counterclockwise"></i> Volver a "Por confirmar"
              </button>
              <button id="btnConfirmar" class="btn btn-success" disabled>
                <i class="bi bi-check2-circle"></i> Confirmar
              </button>
              <button id="btnCancelar" class="btn btn-outline-warning" disabled>
                <i class="bi bi-x-circle"></i> Cancelar
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Encabezado del pedido -->
    <section class="card mb-4 shadow-sm">
      <div class="card-body">
        <div class="row g-3">
          <div class="col-12 col-md-2"><strong>ID:</strong> <span id="h_pedido_id">—</span></div>
          <div class="col-12 col-md-2"><strong>Cliente:</strong> <span id="h_cliente_id">—</span></div>
          <div class="col-12 col-md-3"><strong>Fecha:</strong> <span id="h_fecha_pedido">—</span></div>
          <div class="col-12 col-md-2"><strong>Estado:</strong> <span id="h_estado" class="badge bg-secondary">—</span></div>
          <div class="col-12 col-md-3"><strong>Total:</strong> <span id="h_total">—</span></div>
        </div>
        <div class="row g-3 mt-1">
          <div class="col-12 col-md-3"><strong>Método pago:</strong> <span id="h_metodo_pago">—</span></div>
        </div>
      </div>
    </section>

    <!-- Agregar artículo -->
    <section class="card mb-4 shadow-sm">
      <div class="card-body">
        <h2 class="h5 mb-3">Agregar artículo</h2>
        <div class="row g-3 align-items-end">
          <div class="col-12 col-md-4">
            <label for="producto_id" class="form-label">Producto ID</label>
            <input id="producto_id" type="text" class="form-control" placeholder="prd-1 o 1" maxlength="20" />
          </div>
          <div class="col-6 col-md-2">
            <label for="cantidad" class="form-label">Cantidad</label>
            <input id="cantidad" type="number" class="form-control" step="1" min="1" value="1" />
          </div>
          <div class="col-6 col-md-3">
            <label for="precio_unitario" class="form-label">Precio unitario (opcional)</label>
            <input id="precio_unitario" type="number" class="form-control" step="0.01" min="0" placeholder="Usa precio del producto" />
          </div>
          <div class="col-12 col-md-3 d-grid">
            <button id="btnAgregar" class="btn btn-primary" disabled>
              <i class="bi bi-cart-plus"></i> Agregar al pedido
            </button>
          </div>
        </div>
        <div class="form-text">Si no indicas precio, se usará el precio actual del producto.</div>
      </div>
    </section>

    <!-- Detalle del pedido -->
    <section class="card shadow-sm">
      <div class="card-body">
        <div class="table-responsive">
          <table id="tablaDetalle" class="table table-striped table-hover align-middle" style="width:100%">
            <thead>
              <tr>
                <th>Producto</th>
                <th>Nombre</th>
                <th>Cantidad</th>
                <th>Precio</th>
                <th>Subtotal</th>
                <th class="text-end">Acciones</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <!-- Modal Verificación de stock -->
  <div class="modal fade" id="modalStock" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Verificación de stock</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="table-responsive">
            <table class="table table-sm table-bordered align-middle">
              <thead class="table-light">
                <tr>
                  <th>Producto</th>
                  <th>Requerido</th>
                  <th>Stock disponible</th>
                  <th>Déficit</th>
                </tr>
              </thead>
              <tbody id="stockBody"></tbody>
            </table>
          </div>
          <div id="stockMsg" class="text-muted"></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cerrar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Librerías -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.8/js/dataTables.bootstrap5.min.js"></script>

  <!-- Capa API + UI de este formulario -->
  <script type="module" src="/admin-resources/scripts/apis/controlPedidosManager.js"></script>
  <script type="module" src="/admin-resources/scripts/apis/pedidosManager.js"></script>
  <script type="module" src="/admin-resources/scripts/forms/control_pedidos.js"></script>
</body>
</html>